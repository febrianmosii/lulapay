<h2>Dashboard</h2>

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
        <div class="card">
            <div class="card-body pos-r">
                <div class="row">
                    <div class="col mt-0">
                        <h3 class="card-title">Paid Transactions</h3>
                        <i class="icon icon-usd"></i> 
                    </div>
                </div>
                <h1 class="mt-1 mb-3">Rp. <?= $all_time_transaction ?></h1>
                <div class="mb-0">
                    <span class="text-muted">All Time</span>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
        <div class="card">
            <div class="card-body pos-r">
                <div class="row">
                    <div class="col mt-0 pd-2">
                        <h3 class="card-title">YTD Paid Transactions</h3>
                        <i class="icon icon-usd"></i> 
                    </div>
                </div>
                <h1 class="mt-1 mb-3"><?= $ytd_transaction ?></h1>
                <div class="mb-0">
                    <span class="text-muted">January <?= date('Y') ?> - <?= date('F Y') ?></span>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
        <div class="card">
            <div class="card-body pos-r">
                <div class="row">
                    <div class="col mt-0">
                        <h3 class="card-title">Total Merchants</h3>
                        <i class="icon icon-building-o"></i> 
                    </div>
                </div>
                <h1 class="mt-1 mb-3"><?= $total_merchant; ?></h1>
                <div class="mb-0">
                    <span class="text-muted">Connected</span>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
        <div class="card">
            <div class="card-body pos-r">
                <div class="row">
                    <div class="col mt-0">
                        <h3 class="card-title">Total Customers</h3>
                        <i class="icon icon-users"></i> 
                    </div>
                </div>
                <h1 class="mt-1 mb-3"><?= $total_customer; ?></h1>
                <div class="mb-0">
                    <span class="text-muted">Connected</span>
                </div>
            </div>
        </div>
    </div>
</div>  
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
        <h3>Merchant Transactions</h3>
        <div class="card chart">
            <div class="card-body pos-r apex-chart-container">
                <div
                    class="control-chart centered wrap-legend"
                    data-control="chart-pie"
                    data-size="200"
                    id="pie-chart-trx"
                    data-center-text="100">
                    <ul>
                        <?php foreach ($merchant_transactions as  $transaction) {?>
                        <li><?= $transaction['name'] ?> <span><?= $transaction['total'] ?></span></li>
                        <?php } ?>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
        <h3>Last 10 Days Transactions</h3>
        <div class="card chart">
            <div class="card-body pos-r">
                <div
                    data-control="chart-line"
                    data-time-mode="days"
                    style="height: 240px"
                    data-chart-options="xaxis: {mode: 'time'}">
                    <span
                        data-chart="dataset"
                        data-set-color="#008dc9"
                        <?php if ($latest_10_days_summaries) { ?>
                        data-set-data="
                            <?php foreach ($latest_10_days_summaries as $key => $transaction) { ?> <?= $key != 0 ? ',' : '' ?>[<?= $transaction['timestamp'] ?>, <?= $transaction['value'] ?>]<?php }  ?>
                        "
                        <?php } else { ?>
                            data-set-data="[]"
                        <?php } ?>

                        data-set-name="Visits">
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>  
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
        <h3>Top 5 Payment Methods</h3>
        <div class="card chart">
            <div class="card-body pos-r">
                <div
                    class="control-chart wrap-legend"
                    data-control="chart-bar"
                    data-height="240"
                    data-full-width="1">
                    <ul>
                        <?php foreach ($top_5_payment_methods as $transaction) { ?> 
                            <li><?= $transaction->name ?> <span><?= $transaction->count ?></span></li>
                        <?php } ?>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
        <h3>Top 5 Merchants</h3>
        <div class="card chart">
            <div class="card-body pos-r">
                <div
                    class="control-chart wrap-legend"
                    data-control="chart-bar"
                    data-height="240"
                    data-full-width="1">
                    <ul>
                        <?php foreach ($top_5_payment_merchants as $transaction) { ?> 
                            <li><?= $transaction->name ?> <span><?= $transaction->count ?></span></li>
                        <?php } ?>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>  
<h3>Last 10 Transactions</h3>
<div class="control-list">
    <table class="table data" data-control="rowlink">
        <thead>
            <tr>
                <th><span>Tanggal</span></th>
                <th><span>Invoice No</span></th>
                <th><span>Merchant</span></th>
                <th><span>Customer</span></th>
                <th><span>Payment Method</span></th>
                <th><span>Status</span></th>
                <th><span>Total</span></th>
                <th class="list-setup"><a href="/" title="List options"></a></th>
            </tr>
        </thead>
        <tbody>
            <?php foreach ($latest_10_days_transactions as $transaction) { ?> 
                <tr>
                    <td><?= date('d F Y H:i A', strtotime($transaction->created_at)) ?></td>
                    <td><a href="<?= Backend::url('lulapay/transaction/transactions/preview/'.$transaction->id) ?>"><?= $transaction->invoice_code ?></a></td>
                    <td><?= $transaction->merchant->name ?></td>
                    <td><?= $transaction->customer->name ?></td>
                    <td><?= $transaction->payment_method->name ?></td>
                    <td><?= $transaction->transaction_status->name ?></td>
                    <td class="text-right">Rp. <?= number_format($transaction->total) ?></td>
                    <td>&nbsp;</td>
                </tr>
            <?php } ?>
        </body>
    </table>
    <div class="list-footer">
        <div class="list-pagination">
            <div class="control-pagination">
                <span class="page-iteration">1-5 of 20</span>
                <a href="#" class="page-back" title="Previous page"></a><a href="#" class="page-next" title="Next page"></a>
            </div>
        </div>
    </div>
</div>
